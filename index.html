<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarBot - Your Solar Energy Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient-start: #FDB813;
            --bg-gradient-end: #FF6B35;
            --primary-gradient-start: #FFD93D;
            --primary-gradient-end: #FFA500;
            --chat-bg: #FFF8E7;
            --container-bg: white;
            --text-primary: #2C3E50;
            --text-secondary: #555;
            --border-color: #e0e0e0;
            --message-bot-bg: white;
            --message-bot-border: #FFD93D;
            --input-bg: white;
            --suggestion-bg: #f0f0f0;
        }

        body.dark-theme {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --primary-gradient-start: #FFA500;
            --primary-gradient-end: #FF8C00;
            --chat-bg: #0f0f1e;
            --container-bg: #1a1a2e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: #2d2d44;
            --message-bot-bg: #252538;
            --message-bot-border: #FFA500;
            --input-bg: #252538;
            --suggestion-bg: #2d2d44;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.5s ease;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .container:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(0,0,0,0.35);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            padding: 30px 25px 20px 25px;
            text-align: center;
            color: var(--text-primary);
            position: relative;
            transition: background 0.3s ease;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            animation: slideDown 0.5s ease;
            margin-top: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            animation: slideDown 0.5s ease 0.1s backwards;
            margin-bottom: 15px;
        }

        .header-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
            padding: 0 60px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            padding: 6px 14px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease 0.2s backwards;
            color: #2C3E50;
            z-index: 10;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: rotate(180deg) scale(1.1);
        }

        body.dark-theme .theme-toggle {
            background: rgba(255, 215, 0, 0.3);
            color: #FFD700;
        }

        body.dark-theme .theme-toggle:hover {
            background: rgba(255, 165, 0, 0.4);
        }

        .typing-speed-control {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 5px;
            align-items: center;
            z-index: 10;
        }

        .speed-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            padding: 4px 8px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .speed-btn.active {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(1.1);
        }

        .speed-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .sound-toggle {
            position: absolute;
            top: 60px;
            left: 15px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--text-primary);
            z-index: 10;
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .chat-container {
            flex: 1;
            overflow-y: scroll;
            overflow-x: hidden;
            padding: 20px;
            background: var(--chat-bg);
            transition: background 0.3s ease;
            scroll-behavior: smooth;
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 10px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #FFA500;
            border-radius: 10px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #FF8C00;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            animation: fadeInUp 0.4s ease;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            transition: all 0.3s ease;
        }

        .message-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .message.bot .message-content {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            color: var(--text-primary);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .message:hover .avatar {
            transform: scale(1.1) rotate(5deg);
        }

        .bot .avatar {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
        }

        .user .avatar {
            background: linear-gradient(135deg, #FF8C00 0%, #FF6B35 100%);
        }

        .input-container {
            padding: 20px;
            background: var(--container-bg);
            border-top: 2px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: center;
            transition: background 0.3s ease;
            position: relative;
        }

        #userInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        #userInput:focus {
            border-color: #FFA500;
            box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.1);
            transform: translateY(-1px);
        }

        .voice-btn {
            width: 40px;
            height: 40px;
            background: var(--suggestion-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: #FFA500;
            color: white;
            border-color: #FFA500;
        }

        .voice-btn.listening {
            background: #f44336;
            color: white;
            animation: pulse 1s infinite;
        }

        #sendBtn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: var(--text-primary);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        #sendBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.4);
        }

        #sendBtn:active:not(:disabled) {
            transform: translateY(0);
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .suggestions {
            padding: 15px 20px;
            background: var(--container-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            transition: all 0.3s ease;
            min-height: 80px;
            overflow-y: auto;
        }

        .suggestion-btn {
            padding: 14px 28px;
            background: var(--suggestion-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s ease;
            color: var(--text-primary);
            animation: fadeIn 0.4s ease;
            min-width: 160px;
            font-weight: 500;
            white-space: nowrap;
        }

        .suggestion-btn:hover {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
            border-color: #FFA500;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            animation: fadeInUp 0.3s ease;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: var(--message-bot-bg);
            border: 2px solid var(--border-color);
            border-radius: 18px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #FFA500;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .scroll-bottom {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD93D 0%, #FFA500 100%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .scroll-bottom.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .scroll-bottom:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .chat-wrapper {
            position: relative;
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .message-timestamp {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
            font-style: italic;
        }

        .stats-container {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: var(--suggestion-bg);
            border-radius: 10px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #FFA500;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .word-count {
            position: absolute;
            bottom: 75px;
            right: 30px;
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .reaction-buttons {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .reaction-btn {
            background: var(--suggestion-bg);
            border: 1px solid var(--border-color);
            padding: 4px 10px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .reaction-btn:hover {
            transform: scale(1.2);
            background: #FFA500;
        }

        .reaction-btn.reacted {
            background: #FFA500;
            transform: scale(1.1);
        }

        .reaction-count {
            font-size: 10px;
            font-weight: bold;
        }

        .quick-reply-container {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .quick-reply-btn {
            background: linear-gradient(135deg, #FFD93D 0%, #FFA500 100%);
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #2C3E50;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .quick-reply-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
        }

        .search-container {
            padding: 10px 20px;
            background: var(--container-bg);
            border-bottom: 1px solid var(--border-color);
            display: none;
        }

        .search-container.active {
            display: block;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            font-size: 13px;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .search-results {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-icon {
            background: var(--suggestion-bg);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .action-icon:hover {
            background: #FFA500;
            transform: scale(1.1);
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            background-color: #555;
            color: white;
            text-align: center;
            padding: 5px 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -40px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            white-space: nowrap;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .search-highlight {
            background-color: yellow;
            color: black;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .easter-egg {
            animation: rainbow 3s linear infinite;
        }

        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä Sound ON</button>
            <div class="typing-speed-control">
                <span style="font-size: 10px; opacity: 0.8;">Speed:</span>
                <button class="speed-btn" onclick="setTypingSpeed('slow')">üê¢</button>
                <button class="speed-btn active" onclick="setTypingSpeed('normal')">‚ö°</button>
                <button class="speed-btn" onclick="setTypingSpeed('fast')">üöÄ</button>
            </div>
            <h1>‚òÄÔ∏è SolarBot</h1>
            <p>Your AI-powered solar energy assistant</p>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">üåô</button>
            <div class="header-buttons">
                <button class="header-btn" onclick="openContactForm()">üìß Contact</button>
                <button class="header-btn" onclick="clearChat()">üóëÔ∏è Clear</button>
                <button class="header-btn" onclick="showFunFact()">üí° Fun Fact</button>
                <button class="header-btn" onclick="showStats()">üìä Stats</button>
                <button class="header-btn" onclick="toggleSearch()">üîç Search</button>
            </div>
        </div>

        <div class="chat-wrapper">
            <div class="search-container" id="searchContainer">
                <input type="text" class="search-input" id="searchInput" placeholder="Search messages..." oninput="searchMessages()">
                <div class="search-results" id="searchResults"></div>
            </div>
            <div class="chat-container" id="chatContainer">
                <div class="message bot" style="animation-delay: 0.1s">
                    <div class="avatar">‚òÄÔ∏è</div>
                    <div class="message-content">
                        Hello! I'm SolarBot, your AI-powered solar energy assistant! I can help you understand solar panels, calculate potential savings, schedule appointments, and answer all your renewable energy questions. How can I help you today?
                    </div>
                </div>
            </div>
            <button class="scroll-bottom" id="scrollBottom" onclick="scrollToBottom()">‚Üì</button>
        </div>

        <div class="suggestions" id="suggestionsContainer">
            <button class="suggestion-btn" onclick="sendSuggestion('Why should I get solar panels?')">üí° Why solar?</button>
            <button class="suggestion-btn" onclick="sendSuggestion('How much do solar panels cost?')">üí∞ Costs</button>
            <button class="suggestion-btn" onclick="sendSuggestion('Schedule a consultation')">üìÖ Book appointment</button>
            <button class="suggestion-btn" onclick="sendSuggestion('How do solar panels work?')">‚ö° How they work</button>
        </div>

        <div class="input-container">
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()" title="Voice input">üé§</button>
            <input type="text" id="userInput" placeholder="Ask me about solar power..." onkeypress="handleKeyPress(event)" oninput="updateWordCount()">
            <div class="word-count" id="wordCount">0 / 500</div>
            <button id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        let messageCount = 0;
        let currentTheme = 'light';
        let isListening = false;
        let recognition = null;
        let chatHistory = [];
        let messageIdCounter = 0;
        let typingSpeed = 1000;
        let soundEnabled = true;
        let reactions = {};

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const firstMessage = document.querySelector('.message');
                if (firstMessage) firstMessage.style.opacity = '1';
            }, 100);
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userInput').value = transcript;
                    stopVoice();
                };
                
                recognition.onerror = function() {
                    stopVoice();
                };
                
                recognition.onend = function() {
                    stopVoice();
                };
            } else {
                document.getElementById('voiceBtn').style.display = 'none';
            }
        });

        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            
            if (currentTheme === 'light') {
                body.classList.add('dark-theme');
                toggle.textContent = '‚òÄÔ∏è';
                currentTheme = 'dark';
            } else {
                body.classList.remove('dark-theme');
                toggle.textContent = 'üåô';
                currentTheme = 'light';
            }
        }

        function toggleVoice() {
            if (isListening) {
                stopVoice();
            } else {
                startVoice();
            }
        }

        function startVoice() {
            if (recognition) {
                try {
                    isListening = true;
                    document.getElementById('voiceBtn').classList.add('listening');
                    recognition.start();
                } catch (error) {
                    console.error('Voice recognition error:', error);
                    stopVoice();
                }
            }
        }

        function stopVoice() {
            if (recognition && isListening) {
                try {
                    isListening = false;
                    document.getElementById('voiceBtn').classList.remove('listening');
                    recognition.stop();
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
            }
        }

        function openContactForm() {
            window.open('https://docs.google.com/forms/d/e/1FAIpQLSf0bvHj2dJ3mAQo_FX-cdfG4md5pvnybIXOLCs67uYlFbIy7Q/viewform', '_blank');
            
            setTimeout(() => {
                addMessage("I've opened our contact form in a new tab! Please fill it out and our solar experts will reach out to you within 24 hours. Feel free to ask me any other questions while you're here!", false);
            }, 300);
        }

        function updateSuggestions(context) {
            const suggestionsContainer = document.getElementById('suggestionsContainer');
            let suggestions = [];

            if (context.includes('cost') || context.includes('price') || context.includes('afford')) {
                suggestions = [
                    { display: 'üí≥ Financing options', query: 'How can I afford solar panels?' },
                    { display: 'üéÅ Tax credits', query: 'What are the costs and incentives?' },
                    { display: '‚è±Ô∏è Payback period', query: 'How long until solar pays for itself?' },
                    { display: 'üìß Contact sales', query: 'I want to speak with someone' }
                ];
            } else if (context.includes('schedule') || context.includes('appointment') || context.includes('consult')) {
                suggestions = [
                    { display: 'üìß Fill contact form', query: 'I want to be contacted' },
                    { display: 'üìû Call me back', query: 'Can someone call me?' },
                    { display: 'üí¨ More questions', query: 'I have more questions first' },
                    { display: 'üí∞ Costs', query: 'How much do solar panels cost?' }
                ];
            } else if (context.includes('install') || context.includes('process')) {
                suggestions = [
                    { display: 'üìã Installation steps', query: 'How long does installation take?' },
                    { display: 'üè† Roof requirements', query: 'Will solar work on my roof?' },
                    { display: '‚è∞ Timeline', query: 'What is the installation timeline?' },
                    { display: 'üîß Maintenance', query: 'How much maintenance do solar panels need?' }
                ];
            } else {
                suggestions = [
                    { display: 'üí° Why solar?', query: 'Why should I get solar panels?' },
                    { display: 'üí∞ Costs', query: 'How much do solar panels cost?' },
                    { display: 'üìÖ Book appointment', query: 'Schedule a consultation' },
                    { display: '‚ö° How they work', query: 'How do solar panels work?' }
                ];
            }

            suggestionsContainer.innerHTML = '';
            suggestions.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = 'suggestion-btn';
                btn.textContent = item.display;
                btn.onclick = () => sendSuggestion(item.query);
                btn.style.animationDelay = `${index * 0.1}s`;
                suggestionsContainer.appendChild(btn);
            });
        }

        function scrollToBottom() {
            const chatContainer = document.getElementById('chatContainer');
            setTimeout(() => {
                chatContainer.scrollTo({
                    top: chatContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        document.getElementById('chatContainer').addEventListener('scroll', function() {
            const scrollBottom = document.getElementById('scrollBottom');
            const isScrolledUp = this.scrollHeight - this.scrollTop - this.clientHeight > 100;
            
            if (isScrolledUp) {
                scrollBottom.classList.add('visible');
            } else {
                scrollBottom.classList.remove('visible');
            }
        });

        function getResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            
            if (/schedule|appointment|consult|book|meet|visit/i.test(msg)) {
                setTimeout(() => openContactForm(), 500);
                return "Excellent! I'd be happy to help you schedule a consultation. Let me open our contact form where you can share your availability and preferences. Our solar experts typically respond within 24 hours!";
            }
            
            if (/contact|call|email|reach|speak|talk.*someone/i.test(msg)) {
                window.open('https://docs.google.com/forms/d/e/1FAIpQLSf0bvHj2dJ3mAQo_FX-cdfG4md5pvnybIXOLCs67uYlFbIy7Q/viewform', '_blank');
                return "Perfect! I've opened our contact form in a new tab. Please fill it out and our solar experts will reach out to you within 24 hours. Is there anything else I can help you with?";
            }
            
            if (/(^|\s)(hi|hello|hey|greetings|good morning|good afternoon|good evening)($|\s|!)/i.test(msg)) {
                const greetings = [
                    "Hello! Great to meet you! I'm SolarBot, your AI solar assistant. I can help you calculate savings, answer questions, and connect you with our expert team. What would you like to know about solar energy?",
                    "Hey there! Thanks for chatting with me! I'm here to help you explore solar options. I can run calculations, explain benefits, or schedule a consultation. What interests you most?",
                    "Hi! Welcome! I'm excited to help you discover solar energy. Whether you want to calculate potential savings, learn about costs, or speak with an expert, I'm here to help. What can I do for you today?"
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            if (/why|benefit|advantage|should i|worth it|good idea|pros/i.test(msg)) {
                const benefits = [
                    "Solar panels offer incredible benefits! Financially, most homeowners save $20,000-$75,000 over 25 years, with systems paying for themselves in 6-10 years. Your home value increases by 3-4%, and you'll enjoy energy independence. Environmentally, you're directly fighting climate change - a typical system offsets 3-4 tons of CO2 annually! Plus, with current 30% federal tax credits, there's never been a better time. Would you like to schedule a consultation to learn more?",
                    "Great question! The advantages are substantial: dramatically reduced electricity bills, protection from rising energy costs, increased property value, and real environmental impact. Most systems pay for themselves in 6-10 years through savings. With incentives and financing options available, going solar is more accessible than ever! Would you like to speak with our team?",
                    "There are so many reasons to go solar! You'll save thousands over the system's 25+ year lifespan, lock in low energy costs, boost your home's value, and help fight climate change. Plus, solar technology is proven and reliable. With 30% tax credits available, it's a smart financial decision! Want to learn more about how it could work for your home?"
                ];
                return benefits[Math.floor(Math.random() * benefits.length)];
            }
            
            if (/cost|price|expensive|afford|pay|money|dollar|investment|financing/i.test(msg)) {
                const costs = [
                    "Great question! A typical residential system runs $15,000-$25,000 before incentives. The federal tax credit immediately reduces that by 30%, and many states offer additional rebates. Most homeowners pay $10,500-$17,500 effectively. You can finance with $0 down, and monthly payments are often less than your electric bill. The system pays for itself in 6-10 years! Would you like to discuss financing options with our team?",
                    "Solar costs have dropped dramatically! The average system costs around $18,000 before incentives. With the 30% federal tax credit, that's about $12,600. Financing options make solar accessible with $0 down. You're trading your utility payment for a solar payment that leads to ownership. After 6-10 years, you have free electricity! Want to learn more?",
                    "Investing in solar is more affordable than ever! While systems cost $15,000-$25,000 upfront, the 30% federal tax credit plus state incentives can cut that significantly. Most people finance, paying less monthly than their old electric bill. Over 25-30 years, you'll save $40,000-$100,000! Interested in exploring your options?"
                ];
                return costs[Math.floor(Math.random() * costs.length)];
            }
            
            if (/(how.*work|technology|science|function|panel.*work)/i.test(msg)) {
                const howItWorks = [
                    "Solar panels use photovoltaic cells made of silicon that absorb sunlight. When photons hit these cells, they knock electrons loose, creating DC electrical current. An inverter converts this to AC power for your home. On sunny days, excess power flows back to the grid, earning you credits! Even on cloudy days, modern panels generate 15-20% of peak power. It's completely automated!",
                    "The technology is fascinating! Photovoltaic cells absorb light photons, which frees electrons and creates electric current. Each panel has many cells producing DC electricity. Your inverter converts this to standard AC power. Any excess goes to the grid for credits through net metering. The system works automatically whenever there's light!",
                    "Solar panels use the photovoltaic effect - light energy excites electrons in silicon, creating DC electricity. The inverter converts this to AC power for your home. During peak sun, you generate more than you use - this excess earns grid credits. At night, you draw from the grid using banked credits. It's self-managing!"
                ];
                return howItWorks[Math.floor(Math.random() * howItWorks.length)];
            }
            
            if (/environment|climate|carbon|green|clean|planet|eco|sustainable|pollution/i.test(msg)) {
                const environmental = [
                    "The environmental impact is phenomenal! Every year, a typical system prevents 3-4 tons of CO2 emissions - equivalent to planting 100 trees annually. Over 25 years, that's 100+ tons of CO2 offset! Solar produces zero air pollution, uses no water, and directly combats climate change. You're reducing demand for fossil fuels and helping create a cleaner planet!",
                    "Solar power is one of the best environmental actions you can take! A home solar system offsets the equivalent of driving 100,000 miles in a gas car over its lifetime. It prevents harmful emissions that cause smog, acid rain, and climate change. Unlike fossil fuel plants, solar uses no water and creates no toxic waste. It's personal climate action that really matters!",
                    "The benefits are immediate and lasting! From day one, your system starts preventing carbon emissions. Over its lifetime, it'll offset 100+ tons of CO2 - like planting thousands of trees. You eliminate air and water pollution from your electricity use. Every kilowatt-hour you generate is one less from coal or gas. It's powerful environmental impact!"
                ];
                return environmental[Math.floor(Math.random() * environmental.length)];
            }
            
            if (/thank|thanks|appreciate/i.test(msg)) {
                const thanks = [
                    "You're very welcome! I'm always happy to help people discover solar benefits. Is there anything else you'd like to know, or would you like to speak with our team?",
                    "My pleasure! Solar energy is my passion. Feel free to ask more questions or schedule a consultation anytime!",
                    "Happy to help! If you'd like more detailed information or want to speak with our team, just let me know!"
                ];
                return thanks[Math.floor(Math.random() * thanks.length)];
            }
            
            if (/bye|goodbye|see you|gotta go|later/i.test(msg)) {
                const goodbyes = [
                    "Thanks for chatting! I hope I've helped you understand why solar is such a smart investment. Feel free to return anytime with questions. Have a sunny day! ‚òÄÔ∏è",
                    "It was great talking with you! Consider calculating your savings or scheduling a consultation. Come back anytime. Take care! ‚òÄÔ∏è",
                    "Goodbye! Remember, our calculator and team are here whenever you're ready. Stay bright! ‚òÄÔ∏è"
                ];
                return goodbyes[Math.floor(Math.random() * goodbyes.length)];
            }

            if (/fun fact|solar fact|tell me something interesting|interesting fact/i.test(msg)) {
                return getRandomSolarFact();
            }

            if (/rainbow|party|celebrate|fun/i.test(msg)) {
                setTimeout(() => {
                    document.body.classList.add('easter-egg');
                    setTimeout(() => document.body.classList.remove('easter-egg'), 5000);
                }, 500);
                return "üéâ Party mode activated! Let's celebrate solar energy! üåà‚òÄÔ∏è Did you know solar panels can last 25-30 years? That's a lot of sunshine!";
            }

            const redirects = [
                "That's interesting! While my expertise is solar energy, I'm happy to chat. Since you're here, have you considered going solar? I can answer questions or connect you with our expert team!",
                "Good question! I specialize in solar energy, but I can try to help. Speaking of which, would you like to learn about solar benefits? I'm here to answer any questions you have!",
                "Thanks for asking! I focus mainly on solar energy topics. By the way, have you thought about whether solar might work for your home? I can help you explore the options!",
                "I appreciate the question! While solar energy is my specialty, I'm here for friendly conversation too. Would you like to learn about solar savings, schedule a consultation, or explore what solar could do for you?"
            ];

            return redirects[Math.floor(Math.random() * redirects.length)];
        }

        function playSound(type) {
            if (!soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'send') {
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'receive') {
                oscillator.frequency.value = 600;
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundToggle');
            btn.textContent = soundEnabled ? 'üîä Sound ON' : 'üîá Sound OFF';
            showToast(soundEnabled ? 'Sound enabled' : 'Sound disabled');
        }

        function setTypingSpeed(speed) {
            document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (speed === 'slow') typingSpeed = 2000;
            else if (speed === 'normal') typingSpeed = 1000;
            else if (speed === 'fast') typingSpeed = 300;
            
            showToast(`Typing speed set to ${speed}`);
        }

        function showStats() {
            const totalMessages = chatHistory.length;
            const userMessages = chatHistory.filter(m => m.role === 'user').length;
            const botMessages = chatHistory.filter(m => m.role === 'assistant').length;
            const totalWords = chatHistory.reduce((sum, m) => sum + m.content.split(' ').length, 0);
            
            const statsHTML = `
                <div class="stats-container">
                    <div class="stat-item">
                        <span class="stat-number">${totalMessages}</span>
                        <div class="stat-label">Total Messages</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${userMessages}</span>
                        <div class="stat-label">Your Messages</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${botMessages}</span>
                        <div class="stat-label">Bot Responses</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${totalWords}</span>
                        <div class="stat-label">Total Words</div>
                    </div>
                </div>
            `;
            
            addCustomMessage(statsHTML, false);
        }

        function addCustomMessage(htmlContent, isUser) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.style.opacity = '0';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? 'üë§' : '‚òÄÔ∏è';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = htmlContent;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.opacity = '1';
            }, 10);
            
            scrollToBottom();
        }

        function updateWordCount() {
            const input = document.getElementById('userInput');
            const count = input.value.length;
            const wordCountEl = document.getElementById('wordCount');
            wordCountEl.textContent = `${count} / 500`;
            
            if (count > 450) {
                wordCountEl.style.color = '#f44336';
            } else if (count > 400) {
                wordCountEl.style.color = '#FFA500';
            } else {
                wordCountEl.style.color = 'var(--text-secondary)';
            }
            
            if (count >= 500) {
                input.value = input.value.substring(0, 500);
            }
        }

        function toggleSearch() {
            const searchContainer = document.getElementById('searchContainer');
            searchContainer.classList.toggle('active');
            if (searchContainer.classList.contains('active')) {
                document.getElementById('searchInput').focus();
            }
        }

        function searchMessages() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsEl = document.getElementById('searchResults');
            
            if (!query) {
                resultsEl.textContent = '';
                return;
            }
            
            const matches = chatHistory.filter(m => 
                m.content.toLowerCase().includes(query)
            );
            
            resultsEl.textContent = `Found ${matches.length} message${matches.length !== 1 ? 's' : ''}`;
        }

        function addReaction(messageId, emoji) {
            if (!reactions[messageId]) reactions[messageId] = {};
            if (!reactions[messageId][emoji]) reactions[messageId][emoji] = 0;
            reactions[messageId][emoji]++;
            
            const messageEl = document.querySelector(`[data-message-id="${messageId}"]`);
            const reactionBtn = messageEl.querySelector(`[data-emoji="${emoji}"]`);
            if (reactionBtn) {
                reactionBtn.classList.add('reacted');
                const countEl = reactionBtn.querySelector('.reaction-count');
                if (countEl) countEl.textContent = reactions[messageId][emoji];
            }
            
            playSound('receive');
        }

        function getRandomSolarFact() {
            const facts = [
                "üåü Solar Fact: The sun provides enough energy to Earth in one hour to power the entire world for a year! We just need to capture it better.",
                "‚ö° Solar Fact: Solar panels can generate electricity even on cloudy days! They produce about 10-25% of their normal output depending on cloud thickness.",
                "üöÄ Solar Fact: The International Space Station has been powered by solar panels since 2000! They generate 84-120 kilowatts of electricity.",
                "üåç Solar Fact: Germany, despite its cloudy weather, is one of the world's top solar power producers, proving solar works almost anywhere!",
                "üí∞ Solar Fact: The cost of solar panels has dropped by over 90% since 2010, making it one of the cheapest energy sources available today!",
                "üîã Solar Fact: A single solar panel can prevent 100 tons of CO2 from being released into the atmosphere over its lifetime!",
                "üè† Solar Fact: Homes with solar panels sell 20% faster and for 17% more money on average compared to homes without solar!",
                "‚è∞ Solar Fact: It takes about 2-3 years for a solar panel to generate the same amount of energy that was used to manufacture it!"
            ];
            return facts[Math.floor(Math.random() * facts.length)];
        }

        function clearChat() {
            if (confirm('Are you sure you want to clear the chat history?')) {
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML = '';
                chatHistory = [];
                messageCount = 0;
                
                setTimeout(() => {
                    const welcomeMsg = document.createElement('div');
                    welcomeMsg.className = 'message bot';
                    welcomeMsg.style.opacity = '0';
                    welcomeMsg.innerHTML = `
                        <div class="avatar">‚òÄÔ∏è</div>
                        <div class="message-content">
                            Hello! I'm SolarBot, your AI-powered solar energy assistant! I can help you understand solar panels, calculate potential savings, schedule appointments, and answer all your renewable energy questions. How can I help you today?
                        </div>
                    `;
                    chatContainer.appendChild(welcomeMsg);
                    setTimeout(() => welcomeMsg.style.opacity = '1', 10);
                }, 100);
                
                updateSuggestions('');
            }
        }

        function showFunFact() {
            const fact = getRandomSolarFact();
            addMessage(fact, false);
        }

        function copyMessage(messageId) {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (messageElement) {
                const text = messageElement.querySelector('.message-content').textContent;
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Message copied to clipboard!');
                });
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #4CAF50;
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        }

        function addMessage(content, isUser) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.style.opacity = '0';
            const currentMessageId = messageIdCounter++;
            messageDiv.setAttribute('data-message-id', currentMessageId);
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? 'üë§' : '‚òÄÔ∏è';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            const contentText = document.createElement('div');
            contentText.textContent = content;
            messageContent.appendChild(contentText);
            
            const timestamp = document.createElement('div');
            timestamp.className = 'message-timestamp';
            const now = new Date();
            timestamp.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            messageContent.appendChild(timestamp);
            
            if (!isUser) {
                const reactionsDiv = document.createElement('div');
                reactionsDiv.className = 'reaction-buttons';
                reactionsDiv.innerHTML = `
                    <button class="reaction-btn" data-emoji="üëç" onclick="addReaction(${currentMessageId}, 'üëç')">
                        üëç <span class="reaction-count">0</span>
                    </button>
                    <button class="reaction-btn" data-emoji="‚ù§Ô∏è" onclick="addReaction(${currentMessageId}, '‚ù§Ô∏è')">
                        ‚ù§Ô∏è <span class="reaction-count">0</span>
                    </button>
                    <button class="reaction-btn" data-emoji="üòä" onclick="addReaction(${currentMessageId}, 'üòä')">
                        üòä <span class="reaction-count">0</span>
                    </button>
                    <button class="reaction-btn" data-emoji="üéâ" onclick="addReaction(${currentMessageId}, 'üéâ')">
                        üéâ <span class="reaction-count">0</span>
                    </button>
                `;
                messageContent.appendChild(reactionsDiv);
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                actionsDiv.innerHTML = `
                    <button class="action-icon tooltip" onclick="copyMessage(${currentMessageId})" title="Copy message">
                        üìã
                        <span class="tooltiptext">Copy</span>
                    </button>
                `;
                messageContent.appendChild(actionsDiv);
            }
            
            if (isUser) {
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(avatar);
                playSound('send');
            } else {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
                playSound('receive');
            }
            
            chatContainer.appendChild(messageDiv);
            
            chatHistory.push({
                role: isUser ? 'user' : 'assistant',
                content: content,
                timestamp: new Date().toISOString()
            });
            
            setTimeout(() => {
                messageDiv.style.opacity = '1';
            }, 10);
            
            scrollToBottom();
            
            if (!isUser) {
                updateSuggestions(content.toLowerCase());
                
                if (content.toLowerCase().includes('consultation') || content.toLowerCase().includes('appointment')) {
                    setTimeout(() => addQuickReplies(currentMessageId, [
                        'Yes, schedule it!',
                        'Tell me more first',
                        'What are the costs?'
                    ]), 500);
                } else if (content.toLowerCase().includes('cost') || content.toLowerCase().includes('price')) {
                    setTimeout(() => addQuickReplies(currentMessageId, [
                        'What about financing?',
                        'Any tax credits?',
                        'Schedule consultation'
                    ]), 500);
                }
            }
            
            messageCount++;
        }

        function addQuickReplies(messageId, replies) {
            const messageEl = document.querySelector(`[data-message-id="${messageId}"]`);
            if (!messageEl) return;
            
            const quickReplyDiv = document.createElement('div');
            quickReplyDiv.className = 'quick-reply-container';
            
            replies.forEach(reply => {
                const btn = document.createElement('button');
                btn.className = 'quick-reply-btn';
                btn.textContent = reply;
                btn.onclick = () => {
                    document.getElementById('userInput').value = reply;
                    sendMessage();
                };
                quickReplyDiv.appendChild(btn);
            });
            
            messageEl.querySelector('.message-content').appendChild(quickReplyDiv);
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator active';
            typingDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = '‚òÄÔ∏è';
            
            const dotsDiv = document.createElement('div');
            dotsDiv.className = 'typing-dots';
            dotsDiv.innerHTML = '<span></span><span></span><span></span>';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(dotsDiv);
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            addMessage(message, true);
            input.value = '';
            updateWordCount();
            
            showTypingIndicator();
            
            setTimeout(() => {
                const response = getResponse(message);
                hideTypingIndicator();
                addMessage(response, false);
                
                input.focus();
            }, typingSpeed + Math.random() * 500);
        }

        function sendSuggestion(text) {
            document.getElementById('userInput').value = text;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
    </script>
</body>
</html>
