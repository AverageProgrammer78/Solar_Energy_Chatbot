<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarBot - Your Solar Energy Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient-start: #FDB813;
            --bg-gradient-end: #FF6B35;
            --primary-gradient-start: #FFD93D;
            --primary-gradient-end: #FFA500;
            --chat-bg: #FFF8E7;
            --container-bg: white;
            --text-primary: #2C3E50;
            --text-secondary: #555;
            --border-color: #e0e0e0;
            --message-bot-bg: white;
            --message-bot-border: #FFD93D;
            --input-bg: white;
            --suggestion-bg: #f0f0f0;
        }

        body.dark-theme {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --primary-gradient-start: #FFA500;
            --primary-gradient-end: #FF8C00;
            --chat-bg: #0f0f1e;
            --container-bg: #1a1a2e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: #2d2d44;
            --message-bot-bg: #252538;
            --message-bot-border: #FFA500;
            --input-bg: #252538;
            --suggestion-bg: #2d2d44;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.5s ease;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .container:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(0,0,0,0.35);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            padding: 30px 25px 25px 25px;
            text-align: center;
            color: var(--text-primary);
            position: relative;
            transition: background 0.3s ease;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            animation: slideDown 0.5s ease;
            margin-top: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            animation: slideDown 0.5s ease 0.1s backwards;
            margin-bottom: 5px;
        }

        .menu-toggle {
            position: absolute;
            top: 25px;
            left: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease 0.2s backwards;
            color: #2C3E50;
            z-index: 1001;
        }

        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        body.dark-theme .menu-toggle {
            background: rgba(255, 215, 0, 0.3);
            color: #FFD700;
        }

        .menu-dropdown {
            position: absolute;
            top: 75px;
            left: 25px;
            background: var(--container-bg);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 5px;
            min-width: 200px;
            z-index: 1000;
            animation: slideDown 0.3s ease;
        }

        .menu-dropdown.active {
            display: flex;
        }

        .menu-item {
            background: var(--suggestion-bg);
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--text-primary);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
            transform: translateX(5px);
        }

        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease 0.2s backwards;
            color: #2C3E50;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: rotate(180deg) scale(1.1);
        }

        body.dark-theme .theme-toggle {
            background: rgba(255, 215, 0, 0.3);
            color: #FFD700;
        }

        body.dark-theme .theme-toggle:hover {
            background: rgba(255, 165, 0, 0.4);
        }

        .chat-container {
            flex: 1;
            overflow-y: scroll;
            overflow-x: hidden;
            padding: 20px;
            background: var(--chat-bg);
            transition: background 0.3s ease;
            scroll-behavior: smooth;
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 10px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #FFA500;
            border-radius: 10px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #FF8C00;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            animation: fadeInUp 0.4s ease;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            transition: all 0.3s ease;
        }

        .message-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .message.bot .message-content {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            color: var(--text-primary);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .message:hover .avatar {
            transform: scale(1.1) rotate(5deg);
        }

        .bot .avatar {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
        }

        .user .avatar {
            background: linear-gradient(135deg, #FF8C00 0%, #FF6B35 100%);
        }

        .input-container {
            padding: 20px;
            background: var(--container-bg);
            border-top: 2px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: center;
            transition: background 0.3s ease;
        }

        #userInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        #userInput:focus {
            border-color: #FFA500;
            box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.1);
            transform: translateY(-1px);
        }

        .voice-btn {
            width: 40px;
            height: 40px;
            background: var(--suggestion-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: #FFA500;
            color: white;
            border-color: #FFA500;
        }

        .voice-btn.listening {
            background: #f44336;
            color: white;
            animation: pulse 1s infinite;
        }

        #sendBtn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: var(--text-primary);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        #sendBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.4);
        }

        #sendBtn:active:not(:disabled) {
            transform: translateY(0);
            animation: pulse 0.3s ease;
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .suggestions {
            padding: 15px 20px;
            background: var(--container-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            transition: all 0.3s ease;
            min-height: 80px;
            overflow-y: auto;
        }

        .suggestion-btn {
            padding: 14px 28px;
            background: var(--suggestion-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s ease;
            color: var(--text-primary);
            animation: fadeIn 0.4s ease;
            min-width: 160px;
            font-weight: 500;
            white-space: nowrap;
        }

        .suggestion-btn:hover {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
            border-color: #FFA500;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            animation: fadeInUp 0.3s ease;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: var(--message-bot-bg);
            border: 2px solid var(--border-color);
            border-radius: 18px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #FFA500;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--container-bg);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease;
            position: relative;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h2 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 24px;
        }

        .modal-content p {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 14px;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: var(--suggestion-bg);
            transform: rotate(90deg);
        }

        .scroll-bottom {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD93D 0%, #FFA500 100%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .scroll-bottom.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .scroll-bottom:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .chat-wrapper {
            position: relative;
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .calculator-container {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }

        .calc-input-group {
            margin-bottom: 15px;
        }

        .calc-input-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .calc-input-group input, .calc-input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .calc-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .calc-results {
            margin-top: 20px;
            padding: 15px;
            background: var(--suggestion-bg);
            border-radius: 12px;
            display: none;
        }

        .calc-results.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .result-item {
            margin-bottom: 10px;
            padding: 10px;
            background: var(--container-bg);
            border-radius: 8px;
        }

        .result-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .result-value {
            font-size: 20px;
            font-weight: bold;
            color: #4CAF50;
        }

        .sound-toggle {
            position: absolute;
            top: 25px;
            left: 75px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease 0.2s backwards;
            color: #2C3E50;
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        body.dark-theme .sound-toggle {
            background: rgba(255, 215, 0, 0.3);
            color: #FFD700;
        }

        .stats-container {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: var(--suggestion-bg);
            border-radius: 10px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #FFA500;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .word-count {
            position: absolute;
            bottom: 75px;
            right: 30px;
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .message-timestamp {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
            font-style: italic;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-icon {
            background: var(--suggestion-bg);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .action-icon:hover {
            background: #FFA500;
            transform: scale(1.1);
        }

        .comparison-table {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .comparison-table h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 13px;
        }

        .comparison-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 13px;
        }

        .comparison-table tr:hover {
            background: var(--suggestion-bg);
        }

        .faq-container {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }

        .faq-container h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .faq-item {
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .faq-question {
            background: var(--suggestion-bg);
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-question:hover {
            background: #FFA500;
            color: white;
            transform: translateX(5px);
        }

        .faq-answer {
            padding: 12px;
            color: var(--text-secondary);
            display: none;
            font-size: 13px;
            line-height: 1.6;
        }

        .faq-answer.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .progress-tracker {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }

        .progress-tracker h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .progress-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 20px;
            top: 50px;
            width: 2px;
            height: 100%;
            background: var(--border-color);
        }

        .progress-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--suggestion-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--text-primary);
            flex-shrink: 0;
            margin-right: 15px;
            position: relative;
            z-index: 1;
        }

        .progress-number.completed {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .progress-info h4 {
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 14px;
        }

        .progress-info p {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .testimonial-container {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }

        .testimonial-item {
            background: var(--suggestion-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #FFA500;
        }

        .testimonial-text {
            color: var(--text-primary);
            font-style: italic;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .testimonial-author {
            font-weight: 600;
            color: #FFA500;
            font-size: 14px;
        }

        .testimonial-rating {
            color: #FFD700;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .typing-indicator-text {
            display: none;
            font-size: 12px;
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 10px;
        }

        .typing-indicator-text.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                height: 95vh;
                border-radius: 10px;
            }

            .header {
                padding: 20px 15px 20px 15px;
            }

            .header h1 {
                font-size: 24px;
            }

            .header p {
                font-size: 12px;
            }

            .theme-toggle, .menu-toggle, .sound-toggle {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }

            .sound-toggle {
                left: 70px;
            }

            .menu-dropdown {
                left: 10px;
                min-width: 180px;
            }

            .message-content {
                max-width: 85%;
            }

            .suggestion-btn {
                min-width: 130px;
                padding: 12px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="menu-toggle" onclick="toggleMenu()" id="menuToggle">☰</button>
            <div class="menu-dropdown" id="menuDropdown">
                <button class="menu-item" onclick="openContactForm(); closeMenu();">📧 Contact Us</button>
                <button class="menu-item" onclick="showCalculator(); closeMenu();">🧮 Calculator</button>
                <button class="menu-item" onclick="exportChat(); closeMenu();">💾 Export Chat</button>
                <button class="menu-item" onclick="emailTranscript(); closeMenu();">📨 Email Transcript</button>
                <button class="menu-item" onclick="showStats(); closeMenu();">📊 Statistics</button>
                <button class="menu-item" onclick="clearChat(); closeMenu();">🗑️ Clear Chat</button>
            </div>
            <button class="sound-toggle" id="soundToggle" onclick="toggleSound()" title="Toggle sound">🔊</button>
            <h1>☀️ SolarBot</h1>
            <p>Your AI-powered solar energy assistant</p>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">🌙</button>
        </div>

        <div class="chat-wrapper">
            <div class="chat-container" id="chatContainer">
                <div class="message bot" style="animation-delay: 0.1s">
                    <div class="avatar">☀️</div>
                    <div class="message-content">
                        Hello! I'm SolarBot, your AI-powered solar energy assistant! 🌟 I can help you understand solar panels, calculate potential savings, schedule appointments, and answer all your renewable energy questions. Try asking me about costs, benefits, or use the calculator button above! How can I help you today?
                    </div>
                </div>
            </div>
            <button class="scroll-bottom" id="scrollBottom" onclick="scrollToBottom()">↓</button>
        </div>

        <div class="suggestions" id="suggestionsContainer">
            <button class="suggestion-btn" onclick="sendSuggestion('Why should I get solar panels?')">💡 Why solar?</button>
            <button class="suggestion-btn" onclick="sendSuggestion('How much do solar panels cost?')">💰 Costs</button>
            <button class="suggestion-btn" onclick="sendSuggestion('Schedule a consultation')">📅 Book appointment</button>
            <button class="suggestion-btn" onclick="showCalculator()">🧮 Calculate savings</button>
        </div>

        <div class="input-container">
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()" title="Voice input">🎤</button>
            <input type="text" id="userInput" placeholder="Ask me about solar power..." onkeypress="handleKeyPress(event)" oninput="updateWordCount()">
            <div class="word-count" id="wordCount">0 / 500</div>
            <button id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        let messageCount = 0;
        let currentTheme = 'light';
        let isListening = false;
        let recognition = null;
        let chatHistory = [];
        let messageIdCounter = 0;
        let typingSpeed = 1000;
        let soundEnabled = true;
        let reactions = {};

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const firstMessage = document.querySelector('.message');
                if (firstMessage) firstMessage.style.opacity = '1';
            }, 100);
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userInput').value = transcript;
                    stopVoice();
                };
                
                recognition.onerror = function() {
                    stopVoice();
                };
                
                recognition.onend = function() {
                    stopVoice();
                };
            } else {
                document.getElementById('voiceBtn').style.display = 'none';
            }
        });

        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            
            if (currentTheme === 'light') {
                body.classList.add('dark-theme');
                toggle.textContent = '☀️';
                currentTheme = 'dark';
                showToast('Dark theme activated 🌙');
            } else {
                body.classList.remove('dark-theme');
                toggle.textContent = '🌙';
                currentTheme = 'light';
                showToast('Light theme activated ☀️');
            }
        }

        function toggleMenu() {
            const menu = document.getElementById('menuDropdown');
            const toggle = document.getElementById('menuToggle');
            menu.classList.toggle('active');
            toggle.textContent = menu.classList.contains('active') ? '✕' : '☰';
        }

        function closeMenu() {
            const menu = document.getElementById('menuDropdown');
            const toggle = document.getElementById('menuToggle');
            menu.classList.remove('active');
            toggle.textContent = '☰';
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('menuDropdown');
            const toggle = document.getElementById('menuToggle');
            
            if (menu && toggle && !menu.contains(event.target) && !toggle.contains(event.target)) {
                menu.classList.remove('active');
                toggle.textContent = '☰';
            }
        });

        function toggleVoice() {
            if (isListening) {
                stopVoice();
            } else {
                startVoice();
            }
        }

        function startVoice() {
            if (recognition) {
                try {
                    isListening = true;
                    document.getElementById('voiceBtn').classList.add('listening');
                    recognition.start();
                    showToast('Listening... 🎤');
                } catch (error) {
                    console.error('Voice recognition error:', error);
                    stopVoice();
                }
            }
        }

        function stopVoice() {
            if (recognition && isListening) {
                try {
                    isListening = false;
                    document.getElementById('voiceBtn').classList.remove('listening');
                    recognition.stop();
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
            }
        }

        function openContactForm() {
            window.open('https://docs.google.com/forms/d/e/1FAIpQLSf0bvHj2dJ3mAQo_FX-cdfG4md5pvnybIXOLCs67uYlFbIy7Q/viewform', '_blank');
            
            setTimeout(() => {
                addMessage("I've opened our contact form in a new tab! Please fill it out and our solar experts will reach out to you within 24 hours. Feel free to ask me any other questions while you're here!", false);
            }, 300);
        }

        function showCalculator() {
            const calculatorHTML = `
                <div class="calculator-container">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">☀️ Solar Savings Calculator</h3>
                    <div class="calc-input-group">
                        <label>Monthly Electric Bill ($)</label>
                        <input type="number" id="electricBill" placeholder="e.g., 150" value="150">
                    </div>
                    <div class="calc-input-group">
                        <label>Average Sunlight Hours/Day</label>
                        <input type="number" id="sunHours" placeholder="e.g., 5" value="5" step="0.5">
                    </div>
                    <div class="calc-input-group">
                        <label>System Size (kW)</label>
                        <select id="systemSize">
                            <option value="5">5 kW (Small - $15,000)</option>
                            <option value="7" selected>7 kW (Medium - $21,000)</option>
                            <option value="10">10 kW (Large - $30,000)</option>
                        </select>
                    </div>
                    <div class="calc-input-group">
                        <label>State</label>
                        <select id="state">
                            <option value="0.1">California (High Incentives)</option>
                            <option value="0.08" selected>Texas (Medium Incentives)</option>
                            <option value="0.05">Florida (Standard Incentives)</option>
                            <option value="0.03">Other States</option>
                        </select>
                    </div>
                    <button class="calc-button" onclick="calculateSavings()">Calculate My Savings 🚀</button>
                    <div class="calc-results" id="calcResults"></div>
                </div>
            `;
            addCustomMessage(calculatorHTML, false);
            showToast('Calculator loaded! Fill in your details 📊');
        }

        function calculateSavings() {
            const electricBill = parseFloat(document.getElementById('electricBill').value) || 150;
            const sunHours = parseFloat(document.getElementById('sunHours').value) || 5;
            const systemSize = parseFloat(document.getElementById('systemSize').value) || 7;
            const stateIncentive = parseFloat(document.getElementById('state').value) || 0.08;
            
            // Calculations
            const systemCost = systemSize * 3000;
            const federalTaxCredit = systemCost * 0.30;
            const stateIncentiveAmount = systemCost * stateIncentive;
            const netCost = systemCost - federalTaxCredit - stateIncentiveAmount;
            
            const annualProduction = systemSize * sunHours * 365 * 0.75;
            const annualSavings = electricBill * 12;
            const paybackYears = (netCost / annualSavings).toFixed(1);
            const lifetime25Savings = (annualSavings * 25 - netCost).toFixed(0);
            const monthlyPayment = (netCost / 180).toFixed(0); // 15-year loan
            
            const resultsHTML = `
                <div class="result-item">
                    <div class="result-label">System Cost (Before Incentives)</div>
                    <div class="result-value">${systemCost.toLocaleString()}</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Federal Tax Credit (30%)</div>
                    <div class="result-value">-${federalTaxCredit.toLocaleString()}</div>
                </div>
                <div class="result-item">
                    <div class="result-label">State Incentives</div>
                    <div class="result-value">-${stateIncentiveAmount.toLocaleString()}</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Net Cost</div>
                    <div class="result-value">${netCost.toLocaleString()}</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Annual Savings</div>
                    <div class="result-value">${annualSavings.toLocaleString()}</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Monthly Loan Payment (15yr)</div>
                    <div class="result-value">${monthlyPayment}/mo</div>
                </div>
                <div class="result-item">
                    <div class="result-label">Payback Period</div>
                    <div class="result-value">${paybackYears} years</div>
                </div>
                <div class="result-item">
                    <div class="result-label">25-Year Savings</div>
                    <div class="result-value" style="color: #4CAF50; font-size: 24px;">${lifetime25Savings.toLocaleString()} 🎉</div>
                </div>
            `;
            
            const resultsDiv = document.getElementById('calcResults');
            resultsDiv.innerHTML = resultsHTML;
            resultsDiv.classList.add('show');
            playSound('receive');
            showToast('Calculations complete! 💰');
            
            setTimeout(() => {
                scrollToBottom();
            }, 100);
        }

        function exportChat() {
            if (chatHistory.length === 0) {
                showToast('No messages to export! 📭');
                return;
            }
            
            let exportText = '=== SolarBot Chat Transcript ===\n';
            exportText += `Date: ${new Date().toLocaleString()}\n`;
            exportText += `Total Messages: ${chatHistory.length}\n`;
            exportText += '=================================\n\n';
            
            chatHistory.forEach((msg, index) => {
                const role = msg.role === 'user' ? 'You' : 'SolarBot';
                const time = new Date(msg.timestamp).toLocaleTimeString();
                exportText += `[${time}] ${role}:\n${msg.content}\n\n`;
            });
            
            exportText += '=================================\n';
            exportText += 'Generated by SolarBot - Your Solar Energy Assistant\n';
            exportText += 'Visit us for more information about solar energy!\n';
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SolarBot_Chat_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Chat exported successfully! 📥');
            playSound('receive');
        }

        function emailTranscript() {
            if (chatHistory.length === 0) {
                showToast('No messages to email! 📭');
                return;
            }
            
            let emailBody = 'SolarBot Chat Transcript%0D%0A';
            emailBody += `Date: ${new Date().toLocaleString()}%0D%0A`;
            emailBody += '=================================%0D%0A%0D%0A';
            
            chatHistory.forEach((msg, index) => {
                const role = msg.role === 'user' ? 'You' : 'SolarBot';
                emailBody += `${role}: ${encodeURIComponent(msg.content)}%0D%0A%0D%0A`;
            });
            
            const subject = 'My SolarBot Conversation';
            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${emailBody}`;
            
            window.location.href = mailtoLink;
            showToast('Opening email client... 📧');
        }

        function updateSuggestions(context) {
            const suggestionsContainer = document.getElementById('suggestionsContainer');
            let suggestions = [];

            if (context.includes('cost') || context.includes('price') || context.includes('afford')) {
                suggestions = [
                    { display: '💳 Financing options', query: 'How can I afford solar panels?' },
                    { display: '🧮 Calculate savings', action: () => showCalculator() },
                    { display: '⏱️ Payback period', query: 'How long until solar pays for itself?' },
                    { display: '📧 Contact sales', query: 'I want to speak with someone' }
                ];
            } else if (context.includes('schedule') || context.includes('appointment') || context.includes('consult')) {
                suggestions = [
                    { display: '📧 Fill contact form', action: () => openContactForm() },
                    { display: '💬 More questions', query: 'I have more questions first' },
                    { display: '💰 Costs', query: 'How much do solar panels cost?' },
                    { display: '🧮 Calculator', action: () => showCalculator() }
                ];
            } else if (context.includes('calculator') || context.includes('savings')) {
                suggestions = [
                    { display: '📅 Book appointment', query: 'Schedule a consultation' },
                    { display: '💡 Why solar?', query: 'Why should I get solar panels?' },
                    { display: '💰 Financing', query: 'What financing options are available?' },
                    { display: '📧 Contact', action: () => openContactForm() }
                ];
            } else {
                suggestions = [
                    { display: '💡 Why solar?', query: 'Why should I get solar panels?' },
                    { display: '💰 Costs', query: 'How much do solar panels cost?' },
                    { display: '📅 Book appointment', query: 'Schedule a consultation' },
                    { display: '🧮 Calculate savings', action: () => showCalculator() }
                ];
            }

            suggestionsContainer.innerHTML = '';
            suggestions.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = 'suggestion-btn';
                btn.textContent = item.display;
                
                if (item.action) {
                    btn.onclick = item.action;
                } else {
                    btn.onclick = () => sendSuggestion(item.query);
                }
                
                btn.style.animationDelay = `${index * 0.1}s`;
                suggestionsContainer.appendChild(btn);
            });
        }

        function scrollToBottom() {
            const chatContainer = document.getElementById('chatContainer');
            setTimeout(() => {
                chatContainer.scrollTo({
                    top: chatContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        document.getElementById('chatContainer').addEventListener('scroll', function() {
            const scrollBottom = document.getElementById('scrollBottom');
            const isScrolledUp = this.scrollHeight - this.scrollTop - this.clientHeight > 100;
            
            if (isScrolledUp) {
                scrollBottom.classList.add('visible');
            } else {
                scrollBottom.classList.remove('visible');
            }
        });

        function getResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            
            if (/calculat|savings|estimate|how much.*save/i.test(msg)) {
                setTimeout(() => showCalculator(), 500);
                return "Great! Let me pull up the solar savings calculator for you. Just fill in your details and I'll calculate your potential savings, payback period, and 25-year benefits! 🧮";
            }
            
            if (/schedule|appointment|consult|book|meet|visit/i.test(msg)) {
                setTimeout(() => openContactForm(), 500);
                return "Excellent! I'd be happy to help you schedule a consultation. Let me open our contact form where you can share your availability and preferences. Our solar experts typically respond within 24 hours!";
            }
            
            if (/contact|call|email|reach|speak|talk.*someone/i.test(msg)) {
                window.open('https://docs.google.com/forms/d/e/1FAIpQLSf0bvHj2dJ3mAQo_FX-cdfG4md5pvnybIXOLCs67uYlFbIy7Q/viewform', '_blank');
                return "Perfect! I've opened our contact form in a new tab. Please fill it out and our solar experts will reach out to you within 24 hours. Is there anything else I can help you with?";
            }
            
            if (/(^|\s)(hi|hello|hey|greetings|good morning|good afternoon|good evening)($|\s|!)/i.test(msg)) {
                const greetings = [
                    "Hello! Great to meet you! I'm SolarBot, your AI solar assistant. I can help you calculate savings, answer questions, and connect you with our expert team. What would you like to know about solar energy?",
                    "Hey there! Thanks for chatting with me! I'm here to help you explore solar options. I can run calculations, explain benefits, or schedule a consultation. What interests you most?",
                    "Hi! Welcome! I'm excited to help you discover solar energy. Whether you want to calculate potential savings, learn about costs, or speak with an expert, I'm here to help. What can I do for you today?"
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            if (/why|benefit|advantage|should i|worth it|good idea|pros/i.test(msg)) {
                const benefits = [
                    "Solar panels offer incredible benefits! Financially, most homeowners save $20,000-$75,000 over 25 years, with systems paying for themselves in 6-10 years. Your home value increases by 3-4%, and you'll enjoy energy independence. Environmentally, you're directly fighting climate change - a typical system offsets 3-4 tons of CO2 annually! Plus, with current 30% federal tax credits, there's never been a better time. Want to use our calculator to see your specific savings?",
                    "Great question! The advantages are substantial: dramatically reduced electricity bills, protection from rising energy costs, increased property value, and real environmental impact. Most systems pay for themselves in 6-10 years through savings. With incentives and financing options available, going solar is more accessible than ever! Want to calculate your potential savings?",
                    "There are so many reasons to go solar! You'll save thousands over the system's 25+ year lifespan, lock in low energy costs, boost your home's value, and help fight climate change. Plus, solar technology is proven and reliable. With 30% tax credits available, it's a smart financial decision! Want to see the numbers for your home?"
                ];
                return benefits[Math.floor(Math.random() * benefits.length)];
            }
            
            if (/cost|price|expensive|afford|pay|money|dollar|investment|financing/i.test(msg)) {
                const costs = [
                    "Great question! A typical residential system runs $15,000-$25,000 before incentives. The federal tax credit immediately reduces that by 30%, and many states offer additional rebates. Most homeowners pay $10,500-$17,500 effectively. You can finance with $0 down, and monthly payments are often less than your electric bill. The system pays for itself in 6-10 years! Want to use our calculator for exact numbers?",
                    "Solar costs have dropped dramatically! The average system costs around $18,000 before incentives. With the 30% federal tax credit, that's about $12,600. Financing options make solar accessible with $0 down. You're trading your utility payment for a solar payment that leads to ownership. After 6-10 years, you have free electricity! Want to calculate your specific costs?",
                    "Investing in solar is more affordable than ever! While systems cost $15,000-$25,000 upfront, the 30% federal tax credit plus state incentives can cut that significantly. Most people finance, paying less monthly than their old electric bill. Over 25-30 years, you'll save $40,000-$100,000! Try our calculator to see your savings!"
                ];
                return costs[Math.floor(Math.random() * costs.length)];
            }
            
            if (/(how.*work|technology|science|function|panel.*work)/i.test(msg)) {
                const howItWorks = [
                    "Solar panels use photovoltaic cells made of silicon that absorb sunlight. When photons hit these cells, they knock electrons loose, creating DC electrical current. An inverter converts this to AC power for your home. On sunny days, excess power flows back to the grid, earning you credits! Even on cloudy days, modern panels generate 15-20% of peak power. It's completely automated!",
                    "The technology is fascinating! Photovoltaic cells absorb light photons, which frees electrons and creates electric current. Each panel has many cells producing DC electricity. Your inverter converts this to standard AC power. Any excess goes to the grid for credits through net metering. The system works automatically whenever there's light!",
                    "Solar panels use the photovoltaic effect - light energy excites electrons in silicon, creating DC electricity. The inverter converts this to AC power for your home. During peak sun, you generate more than you use - this excess earns grid credits. At night, you draw from the grid using banked credits. It's self-managing!"
                ];
                return howItWorks[Math.floor(Math.random() * howItWorks.length)];
            }
            
            if (/environment|climate|carbon|green|clean|planet|eco|sustainable|pollution/i.test(msg)) {
                const environmental = [
                    "The environmental impact is phenomenal! Every year, a typical system prevents 3-4 tons of CO2 emissions - equivalent to planting 100 trees annually. Over 25 years, that's 100+ tons of CO2 offset! Solar produces zero air pollution, uses no water, and directly combats climate change. You're reducing demand for fossil fuels and helping create a cleaner planet!",
                    "Solar power is one of the best environmental actions you can take! A home solar system offsets the equivalent of driving 100,000 miles in a gas car over its lifetime. It prevents harmful emissions that cause smog, acid rain, and climate change. Unlike fossil fuel plants, solar uses no water and creates no toxic waste. It's personal climate action that really matters!",
                    "The benefits are immediate and lasting! From day one, your system starts preventing carbon emissions. Over its lifetime, it'll offset 100+ tons of CO2 - like planting thousands of trees. You eliminate air and water pollution from your electricity use. Every kilowatt-hour you generate is one less from coal or gas. It's powerful environmental impact!"
                ];
                return environmental[Math.floor(Math.random() * environmental.length)];
            }
            
            if (/thank|thanks|appreciate/i.test(msg)) {
                const thanks = [
                    "You're very welcome! I'm always happy to help people discover solar benefits. Is there anything else you'd like to know, or would you like to use our calculator or speak with our team?",
                    "My pleasure! Solar energy is my passion. Feel free to ask more questions, try the calculator, or schedule a consultation anytime!",
                    "Happy to help! If you'd like to calculate your savings or speak with our team, just let me know!"
                ];
                return thanks[Math.floor(Math.random() * thanks.length)];
            }
            
            if (/bye|goodbye|see you|gotta go|later/i.test(msg)) {
                const goodbyes = [
                    "Thanks for chatting! I hope I've helped you understand why solar is such a smart investment. Feel free to return anytime with questions. Have a sunny day! ☀️",
                    "It was great talking with you! Consider using our calculator or scheduling a consultation. Come back anytime. Take care! ☀️",
                    "Goodbye! Remember, our calculator and team are here whenever you're ready. Stay bright! ☀️"
                ];
                return goodbyes[Math.floor(Math.random() * goodbyes.length)];
            }

            if (/financing|loan|payment plan|monthly payment/i.test(msg)) {
                return "Financing solar is easier than ever! Most providers offer $0 down with monthly payments often lower than your current electric bill. Options include solar loans (own the system, get tax credits), solar leases (no upfront cost, fixed monthly rate), and power purchase agreements (pay only for energy produced). Many homeowners qualify instantly, and the 30% federal tax credit can be applied to reduce your loan amount. Want to use our calculator to see estimated monthly payments?";
            }

            if (/roof|installation|install/i.test(msg)) {
                return "Most roofs are perfect for solar! Ideal conditions include south-facing with minimal shade, but east and west-facing roofs work great too. Installation typically takes 1-3 days after permits are approved. The entire process from consultation to activation averages 2-3 months. Modern mounting systems don't damage your roof - they're designed to protect it! Solar panels can even extend your roof's life by shielding it from weather. Want to schedule a free roof assessment?";
            }

            const redirects = [
                "That's interesting! While my expertise is solar energy, I'm happy to chat. Since you're here, have you considered using our calculator to see potential savings? I can also answer questions or connect you with our expert team!",
                "Good question! I specialize in solar energy, but I can try to help. Speaking of which, would you like to learn about solar benefits? Try our calculator or ask me anything!",
                "Thanks for asking! I focus mainly on solar energy topics. By the way, have you checked out our savings calculator? I can help you explore what solar could do for you!",
                "I appreciate the question! While solar energy is my specialty, I'm here for friendly conversation too. Would you like to calculate potential savings, schedule a consultation, or explore what solar could do for you?"
            ];

            return redirects[Math.floor(Math.random() * redirects.length)];
        }

        function playSound(type) {
            if (!soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'send') {
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'receive') {
                oscillator.frequency.value = 600;
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundToggle');
            btn.textContent = soundEnabled ? '🔊' : '🔇';
            btn.title = soundEnabled ? 'Sound ON' : 'Sound OFF';
            showToast(soundEnabled ? 'Sound enabled 🔊' : 'Sound disabled 🔇');
        }

        function showStats() {
            const totalMessages = chatHistory.length;
            const userMessages = chatHistory.filter(m => m.role === 'user').length;
            const botMessages = chatHistory.filter(m => m.role === 'assistant').length;
            const totalWords = chatHistory.reduce((sum, m) => sum + m.content.split(' ').length, 0);
            const avgWordsPerMsg = totalMessages > 0 ? Math.round(totalWords / totalMessages) : 0;
            
            const statsHTML = `
                <div class="stats-container">
                    <div class="stat-item">
                        <span class="stat-number">${totalMessages}</span>
                        <div class="stat-label">Total Messages</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${userMessages}</span>
                        <div class="stat-label">Your Messages</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${botMessages}</span>
                        <div class="stat-label">Bot Responses</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${totalWords}</span>
                        <div class="stat-label">Total Words</div>
                    </div>
                </div>
                <p style="text-align: center; margin-top: 10px; font-size: 13px; color: var(--text-secondary);">
                    Average ${avgWordsPerMsg} words per message
                </p>
            `;
            
            addCustomMessage(statsHTML, false);
            showToast('Stats loaded! 📊');
        }

        function addCustomMessage(htmlContent, isUser) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.style.opacity = '0';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? '👤' : '☀️';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = htmlContent;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.opacity = '1';
            }, 10);
            
            scrollToBottom();
        }

        function updateWordCount() {
            const input = document.getElementById('userInput');
            const count = input.value.length;
            const wordCountEl = document.getElementById('wordCount');
            wordCountEl.textContent = `${count} / 500`;
            
            if (count > 450) {
                wordCountEl.style.color = '#f44336';
            } else if (count > 400) {
                wordCountEl.style.color = '#FFA500';
            } else {
                wordCountEl.style.color = 'var(--text-secondary)';
            }
            
            if (count >= 500) {
                input.value = input.value.substring(0, 500);
            }
        }

        function addReaction(messageId, emoji) {
            if (!reactions[messageId]) reactions[messageId] = {};
            if (!reactions[messageId][emoji]) reactions[messageId][emoji] = 0;
            reactions[messageId][emoji]++;
            
            const messageEl = document.querySelector(`[data-message-id="${messageId}"]`);
            const reactionBtn = messageEl.querySelector(`[data-emoji="${emoji}"]`);
            if (reactionBtn) {
                reactionBtn.classList.add('reacted');
                const countEl = reactionBtn.querySelector('.reaction-count');
                if (countEl) countEl.textContent = reactions[messageId][emoji];
            }
            
            playSound('receive');
        }

        function clearChat() {
            if (confirm('Are you sure you want to clear the chat history?')) {
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML = '';
                chatHistory = [];
                messageCount = 0;
                
                setTimeout(() => {
                    const welcomeMsg = document.createElement('div');
                    welcomeMsg.className = 'message bot';
                    welcomeMsg.style.opacity = '0';
                    welcomeMsg.innerHTML = `
                        <div class="avatar">☀️</div>
                        <div class="message-content">
                            Hello! I'm SolarBot, your AI-powered solar energy assistant! 🌟 I can help you understand solar panels, calculate potential savings, schedule appointments, and answer all your renewable energy questions. Try asking me about costs, benefits, or use the calculator button above! How can I help you today?
                        </div>
                    `;
                    chatContainer.appendChild(welcomeMsg);
                    setTimeout(() => welcomeMsg.style.opacity = '1', 10);
                }, 100);
                
                updateSuggestions('');
                showToast('Chat cleared! 🗑️');
            }
        }

        function copyMessage(messageId) {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (messageElement) {
                const text = messageElement.querySelector('.message-content').textContent;
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Message copied! 📋');
                });
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #4CAF50;
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 14px;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        function addMessage(content, isUser) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.style.opacity = '0';
            const currentMessageId = messageIdCounter++;
            messageDiv.setAttribute('data-message-id', currentMessageId);
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? '👤' : '☀️';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            const contentText = document.createElement('div');
            contentText.textContent = content;
            messageContent.appendChild(contentText);
            
            const timestamp = document.createElement('div');
            timestamp.className = 'message-timestamp';
            const now = new Date();
            timestamp.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            messageContent.appendChild(timestamp);
            
            if (!isUser) {
                const reactionsDiv = document.createElement('div');
                reactionsDiv.className = 'reaction-buttons';
                reactionsDiv.innerHTML = `
                    <button class="reaction-btn" data-emoji="👍" onclick="addReaction(${currentMessageId}, '👍')">
                        👍 <span class="reaction-count">0</span>
                    </button>
                    <button class="reaction-btn" data-emoji="❤️" onclick="addReaction(${currentMessageId}, '❤️')">
                        ❤️ <span class="reaction-count">0</span>
                    </button>
                    <button class="reaction-btn" data-emoji="😊" onclick="addReaction(${currentMessageId}, '😊')">
                        😊 <span class="reaction-count">0</span>
                    </button>
                    <button class="reaction-btn" data-emoji="🎉" onclick="addReaction(${currentMessageId}, '🎉')">
                        🎉 <span class="reaction-count">0</span>
                    </button>
                `;
                messageContent.appendChild(reactionsDiv);
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                actionsDiv.innerHTML = `
                    <button class="action-icon" onclick="copyMessage(${currentMessageId})" title="Copy message">
                        📋
                    </button>
                `;
                messageContent.appendChild(actionsDiv);
            }
            
            if (isUser) {
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(avatar);
                playSound('send');
            } else {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
                playSound('receive');
            }
            
            chatContainer.appendChild(messageDiv);
            
            chatHistory.push({
                role: isUser ? 'user' : 'assistant',
                content: content,
                timestamp: new Date().toISOString()
            });
            
            setTimeout(() => {
                messageDiv.style.opacity = '1';
            }, 10);
            
            scrollToBottom();
            
            if (!isUser) {
                updateSuggestions(content.toLowerCase());
            }
            
            messageCount++;
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator active';
            typingDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = '☀️';
            
            const dotsDiv = document.createElement('div');
            dotsDiv.className = 'typing-dots';
            dotsDiv.innerHTML = '<span></span><span></span><span></span>';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(dotsDiv);
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            addMessage(message, true);
            input.value = '';
            updateWordCount();
            
            showTypingIndicator();
            
            setTimeout(() => {
                const response = getResponse(message);
                hideTypingIndicator();
                addMessage(response, false);
                
                input.focus();
            }, typingSpeed + Math.random() * 500);
        }

        function sendSuggestion(text) {
            document.getElementById('userInput').value = text;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
    </script>
</body>
</html>
