<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarBot - Your Solar Energy Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient-start: #FDB813;
            --bg-gradient-end: #FF6B35;
            --primary-gradient-start: #FFD93D;
            --primary-gradient-end: #FFA500;
            --chat-bg: #FFF8E7;
            --container-bg: white;
            --text-primary: #2C3E50;
            --text-secondary: #555;
            --border-color: #e0e0e0;
            --message-bot-bg: white;
            --message-bot-border: #FFD93D;
            --input-bg: white;
            --suggestion-bg: #f0f0f0;
        }

        body.dark-theme {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --primary-gradient-start: #FFA500;
            --primary-gradient-end: #FF8C00;
            --chat-bg: #0f0f1e;
            --container-bg: #1a1a2e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: #2d2d44;
            --message-bot-bg: #252538;
            --message-bot-border: #FFA500;
            --input-bg: #252538;
            --suggestion-bg: #2d2d44;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.5s ease;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 700px;
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .container:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(0,0,0,0.35);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            padding: 25px;
            text-align: center;
            color: var(--text-primary);
            position: relative;
            transition: background 0.3s ease;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            animation: slideDown 0.5s ease;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            animation: slideDown 0.5s ease 0.1s backwards;
        }

        .header-buttons {
            position: absolute;
            top: 25px;
            left: 25px;
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease 0.2s backwards;
            color: #2C3E50;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: rotate(180deg) scale(1.1);
        }

        body.dark-theme .theme-toggle {
            background: rgba(255, 215, 0, 0.3);
            color: #FFD700;
        }

        body.dark-theme .theme-toggle:hover {
            background: rgba(255, 165, 0, 0.4);
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--chat-bg);
            transition: background 0.3s ease;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            animation: fadeInUp 0.4s ease;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            transition: all 0.3s ease;
        }

        .message-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .message.bot .message-content {
            background: var(--message-bot-bg);
            border: 2px solid var(--message-bot-border);
            color: var(--text-primary);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }

        .calculator-widget {
            background: var(--container-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
            max-width: 400px;
        }

        .calculator-widget h4 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .calc-input-group {
            margin-bottom: 15px;
        }

        .calc-input-group label {
            display: block;
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 5px;
        }

        .calc-input-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .calc-result {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }

        .calc-result h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .calc-result p {
            font-size: 13px;
            opacity: 0.95;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .message:hover .avatar {
            transform: scale(1.1) rotate(5deg);
        }

        .bot .avatar {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
        }

        .user .avatar {
            background: linear-gradient(135deg, #FF8C00 0%, #FF6B35 100%);
        }

        .input-container {
            padding: 20px;
            background: var(--container-bg);
            border-top: 2px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: center;
            transition: background 0.3s ease;
        }

        #userInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        #userInput:focus {
            border-color: #FFA500;
            box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.1);
            transform: translateY(-1px);
        }

        .voice-btn {
            width: 40px;
            height: 40px;
            background: var(--suggestion-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: #FFA500;
            color: white;
            border-color: #FFA500;
        }

        .voice-btn.listening {
            background: #f44336;
            color: white;
            animation: pulse 1s infinite;
        }

        #sendBtn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: var(--text-primary);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        #sendBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.4);
        }

        #sendBtn:active:not(:disabled) {
            transform: translateY(0);
            animation: pulse 0.3s ease;
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .suggestions {
            padding: 10px 20px;
            background: var(--container-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            transition: all 0.3s ease;
            max-height: 200px;
            overflow-y: auto;
        }

        .suggestion-btn {
            padding: 8px 16px;
            background: var(--suggestion-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            color: var(--text-primary);
            animation: fadeIn 0.4s ease;
        }

        .suggestion-btn:hover {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
            border-color: #FFA500;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            animation: fadeInUp 0.3s ease;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: var(--message-bot-bg);
            border: 2px solid var(--border-color);
            border-radius: 18px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #FFA500;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--container-bg);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease;
            position: relative;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h2 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 24px;
        }

        .modal-content p {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 14px;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: var(--suggestion-bg);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #FFA500;
            box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #FFD93D 0%, #FFA500 100%);
            color: #2C3E50;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 165, 0, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            animation: slideDown 0.4s ease;
        }

        .success-message h3 {
            margin-bottom: 8px;
        }

        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            animation: slideDown 0.4s ease;
        }

        .scroll-bottom {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD93D 0%, #FFA500 100%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .scroll-bottom.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .scroll-bottom:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .chat-wrapper {
            position: relative;
        }

        .loading-spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid #FFA500;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .quick-action-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #FFD93D 0%, #FFA500 100%);
            color: #2C3E50;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-buttons">
                <button class="header-btn" onclick="openContactForm()">📧 Contact Us</button>
            </div>
            <h1>☀️ SolarBot</h1>
            <p>Your AI-powered solar energy assistant</p>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">🌙</button>
        </div>

        <div class="chat-wrapper">
            <div class="chat-container" id="chatContainer">
                <div class="message bot" style="animation-delay: 0.1s">
                    <div class="avatar">☀️</div>
                    <div class="message-content">
                        Hello! I'm SolarBot, your AI-powered solar energy assistant! I can help you understand solar panels, calculate potential savings, schedule appointments, and answer all your renewable energy questions. How can I help you today?
                    </div>
                </div>
            </div>
            <button class="scroll-bottom" id="scrollBottom" onclick="scrollToBottom()">↓</button>
        </div>

        <div class="suggestions" id="suggestionsContainer">
            <button class="suggestion-btn" onclick="sendSuggestion('Why should I get solar panels?')">💡 Why solar?</button>
            <button class="suggestion-btn" onclick="sendSuggestion('How much do solar panels cost?')">💰 Costs</button>
            <button class="suggestion-btn" onclick="sendSuggestion('Schedule a consultation')">📅 Book appointment</button>
            <button class="suggestion-btn" onclick="sendSuggestion('How do solar panels work?')">⚡ How they work</button>
        </div>

        <div class="input-container">
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()" title="Voice input">🎤</button>
            <input type="text" id="userInput" placeholder="Ask me about solar power..." onkeypress="handleKeyPress(event)">
            <button id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <!-- Contact Form Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content" style="max-width: 650px;">
            <button class="close-modal" onclick="closeContactForm()">×</button>
            <h2>Get in Touch</h2>
            <p>Interested in solar? Fill out this form and we'll contact you!</p>
            <div id="formContent">
                <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSf0bvHj2dJ3mAQo_FX-cdfG4md5pvnybIXOLCs67uYlFbIy7Q/viewform?embedded=true" width="100%" height="800" frameborder="0" marginheight="0" marginwidth="0" style="border-radius: 10px;">Loading…</iframe>
            </div>
        </div>
    </div>

    <script>
        let messageCount = 0;
        let currentTheme = 'light';
        let isListening = false;
        let recognition = null;
        let chatHistory = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const firstMessage = document.querySelector('.message');
                if (firstMessage) firstMessage.style.opacity = '1';
            }, 100);
            
            // Initialize speech recognition if available
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userInput').value = transcript;
                    stopVoice();
                };
                
                recognition.onerror = function() {
                    stopVoice();
                };
                
                recognition.onend = function() {
                    stopVoice();
                };
            } else {
                document.getElementById('voiceBtn').style.display = 'none';
            }
        });

        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            
            if (currentTheme === 'light') {
                body.classList.add('dark-theme');
                toggle.textContent = '☀️';
                currentTheme = 'dark';
            } else {
                body.classList.remove('dark-theme');
                toggle.textContent = '🌙';
                currentTheme = 'light';
            }
        }

        function toggleVoice() {
            if (isListening) {
                stopVoice();
            } else {
                startVoice();
            }
        }

        function startVoice() {
            if (recognition) {
                try {
                    isListening = true;
                    document.getElementById('voiceBtn').classList.add('listening');
                    recognition.start();
                } catch (error) {
                    console.error('Voice recognition error:', error);
                    stopVoice();
                }
            }
        }

        function stopVoice() {
            if (recognition && isListening) {
                try {
                    isListening = false;
                    document.getElementById('voiceBtn').classList.remove('listening');
                    recognition.stop();
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
            }
        }

        function openCalculator() {
            document.getElementById('calculatorModal').classList.add('active');
            calculateSavings();
        }

        function closeCalculator() {
            document.getElementById('calculatorModal').classList.remove('active');
        }

        function calculateSavings() {
            const monthlyBill = parseFloat(document.getElementById('monthlyBill').value) || 0;
            const sunHours = parseFloat(document.getElementById('sunHours').value) || 5;
            const roofSpace = parseFloat(document.getElementById('roofSpace').value) || 400;
            const state = document.getElementById('stateSelect').value;
            
            // Calculations
            const systemSize = Math.min((roofSpace / 80), 10); // kW
            const annualProduction = systemSize * sunHours * 365 * 0.75; // kWh
            const annualSavings = monthlyBill * 12 * 0.8;
            const systemCost = systemSize * 2800; // Average cost per kW
            const federalTaxCredit = systemCost * 0.3;
            const netCost = systemCost - federalTaxCredit;
            const paybackYears = netCost / annualSavings;
            const twentyYearSavings = (annualSavings * 25) - netCost;
            
            const resultsHTML = `
                <div class="calc-result">
                    <h3>Your Estimated Savings</h3>
                    <p style="margin-top: 10px;"><strong>Recommended System Size:</strong> ${systemSize.toFixed(1)} kW</p>
                    <p><strong>Annual Savings:</strong> ${annualSavings.toFixed(0)}</p>
                    <p><strong>Total Cost:</strong> ${systemCost.toFixed(0)}</p>
                    <p><strong>After Tax Credit:</strong> ${netCost.toFixed(0)}</p>
                    <p><strong>Payback Period:</strong> ${paybackYears.toFixed(1)} years</p>
                    <p><strong>25-Year Net Savings:</strong> ${twentyYearSavings.toFixed(0)}</p>
                </div>
            `;
            
            document.getElementById('calculatorResults').innerHTML = resultsHTML;
        }

        function saveCalculation() {
            const monthlyBill = document.getElementById('monthlyBill').value;
            const results = document.getElementById('calculatorResults').innerText;
            
            closeCalculator();
            
            // Add to chat
            addMessage("I'd like to save these calculations and get more information", true);
            setTimeout(() => {
                addBotMessageWithCalculator(results);
            }, 800);
        }

        function addBotMessageWithCalculator(calcResults) {
            const message = `Great! Based on your calculations, solar could save you a significant amount. Here's your personalized estimate:\n\n${calcResults}\n\nWould you like to schedule a free consultation to discuss these numbers in detail?`;
            addMessage(message, false);
            
            // Add quick actions
            setTimeout(() => {
                addQuickActions();
            }, 500);
        }

        function addQuickActions() {
            const chatContainer = document.getElementById('chatContainer');
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'message bot';
            actionsDiv.style.opacity = '0';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = '☀️';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = `
                <strong>Quick Actions:</strong>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="openContactForm()">📧 Contact Us</button>
                    <button class="quick-action-btn" onclick="sendSuggestion('Schedule a consultation')">📅 Book Appointment</button>
                    <button class="quick-action-btn" onclick="sendSuggestion('Tell me about financing options')">💳 Financing</button>
                </div>
            `;
            
            actionsDiv.appendChild(avatar);
            actionsDiv.appendChild(messageContent);
            chatContainer.appendChild(actionsDiv);
            
            setTimeout(() => {
                actionsDiv.style.opacity = '1';
            }, 10);
            
            scrollToBottom();
        }

        function openContactForm() {
            // Open Google Form in a new tab
            window.open('https://docs.google.com/forms/d/e/1FAIpQLSf0bvHj2dJ3mAQo_FX-cdfG4md5pvnybIXOLCs67uYlFbIy7Q/viewform', '_blank');
            
            // Add bot message after a short delay
            setTimeout(() => {
                addMessage("I've opened our contact form in a new tab! Please fill it out and our solar experts will reach out to you within 24 hours. Feel free to ask me any other questions while you're here!", false);
            }, 300);
        }

        function closeContactForm() {
            document.getElementById('contactModal').classList.remove('active');
        }

        function updateSuggestions(context) {
            const suggestionsContainer = document.getElementById('suggestionsContainer');
            let suggestions = [];

            if (context.includes('cost') || context.includes('price') || context.includes('afford')) {
                suggestions = [
                    { display: '💳 Financing options', query: 'How can I afford solar panels?' },
                    { display: '🎁 Tax credits', query: 'What are the costs and incentives?' },
                    { display: '⏱️ Payback period', query: 'How long until solar pays for itself?' },
                    { display: '📧 Contact sales', query: 'I want to speak with someone' }
                ];
            } else if (context.includes('schedule') || context.includes('appointment') || context.includes('consult')) {
                suggestions = [
                    { display: '📧 Fill contact form', query: 'I want to be contacted' },
                    { display: '📞 Call me back', query: 'Can someone call me?' },
                    { display: '💬 More questions', query: 'I have more questions first' },
                    { display: '💰 Costs', query: 'How much do solar panels cost?' }
                ];
            } else if (context.includes('install') || context.includes('process')) {
                suggestions = [
                    { display: '📋 Installation steps', query: 'How long does installation take?' },
                    { display: '🏠 Roof requirements', query: 'Will solar work on my roof?' },
                    { display: '⏰ Timeline', query: 'What is the installation timeline?' },
                    { display: '🔧 Maintenance', query: 'How much maintenance do solar panels need?' }
                ];
            } else {
                suggestions = [
                    { display: '💡 Why solar?', query: 'Why should I get solar panels?' },
                    { display: '💰 Costs', query: 'How much do solar panels cost?' },
                    { display: '📅 Book appointment', query: 'Schedule a consultation' },
                    { display: '⚡ How they work', query: 'How do solar panels work?' }
                ];
            }

            suggestionsContainer.innerHTML = '';
            suggestions.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = 'suggestion-btn';
                btn.textContent = item.display;
                btn.onclick = () => sendSuggestion(item.query);
                btn.style.animationDelay = `${index * 0.1}s`;
                suggestionsContainer.appendChild(btn);
            });
        }

        function scrollToBottom() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.scrollTo({
                top: chatContainer.scrollHeight,
                behavior: 'smooth'
            });
        }

        document.getElementById('chatContainer').addEventListener('scroll', function() {
            const scrollBottom = document.getElementById('scrollBottom');
            const isScrolledUp = this.scrollHeight - this.scrollTop - this.clientHeight > 100;
            
            if (isScrolledUp) {
                scrollBottom.classList.add('visible');
            } else {
                scrollBottom.classList.remove('visible');
            }
        });

        function getResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            
            // Appointment/Schedule trigger
            if (/schedule|appointment|consult|book|meet|visit/i.test(msg)) {
                setTimeout(() => openContactForm(), 500);
                return "Excellent! I'd be happy to help you schedule a consultation. Let me open our contact form where you can share your availability and preferences. Our solar experts typically respond within 24 hours!";
            }
            
            // Contact trigger
            if (/contact|call|email|reach|speak|talk.*someone/i.test(msg)) {
                window.open('https://docs.google.com/forms/d/e/1FAIpQLSf0bvHj2dJ3mAQo_FX-cdfG4md5pvnybIXOLCs67uYlFbIy7Q/viewform', '_blank');
                return "Perfect! I've opened our contact form in a new tab. Please fill it out and our solar experts will reach out to you within 24 hours. Is there anything else I can help you with?";
            }
            
            // Greetings
            if (/(^|\s)(hi|hello|hey|greetings|good morning|good afternoon|good evening)($|\s|!)/i.test(msg)) {
                const greetings = [
                    "Hello! Great to meet you! I'm SolarBot, your AI solar assistant. I can help you calculate savings, answer questions, and connect you with our expert team. What would you like to know about solar energy?",
                    "Hey there! Thanks for chatting with me! I'm here to help you explore solar options. I can run calculations, explain benefits, or schedule a consultation. What interests you most?",
                    "Hi! Welcome! I'm excited to help you discover solar energy. Whether you want to calculate potential savings, learn about costs, or speak with an expert, I'm here to help. What can I do for you today?"
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            // Benefits and "why" questions
            if (/why|benefit|advantage|should i|worth it|good idea|pros/i.test(msg)) {
                const benefits = [
                    "Solar panels offer incredible benefits! Financially, most homeowners save $20,000-$75,000 over 25 years, with systems paying for themselves in 6-10 years. Your home value increases by 3-4%, and you'll enjoy energy independence. Environmentally, you're directly fighting climate change - a typical system offsets 3-4 tons of CO2 annually! Plus, with current 30% federal tax credits, there's never been a better time. Would you like to schedule a consultation to learn more?",
                    "Great question! The advantages are substantial: dramatically reduced electricity bills, protection from rising energy costs, increased property value, and real environmental impact. Most systems pay for themselves in 6-10 years through savings. With incentives and financing options available, going solar is more accessible than ever! Would you like to speak with our team?",
                    "There are so many reasons to go solar! You'll save thousands over the system's 25+ year lifespan, lock in low energy costs, boost your home's value, and help fight climate change. Plus, solar technology is proven and reliable. With 30% tax credits available, it's a smart financial decision! Want to learn more about how it could work for your home?"
                ];
                return benefits[Math.floor(Math.random() * benefits.length)];
            }
            
            // Cost questions
            if (/cost|price|expensive|afford|pay|money|dollar|investment|financing/i.test(msg)) {
                const costs = [
                    "Great question! A typical residential system runs $15,000-$25,000 before incentives. The federal tax credit immediately reduces that by 30%, and many states offer additional rebates. Most homeowners pay $10,500-$17,500 effectively. You can finance with $0 down, and monthly payments are often less than your electric bill. The system pays for itself in 6-10 years! Would you like to discuss financing options with our team?",
                    "Solar costs have dropped dramatically! The average system costs around $18,000 before incentives. With the 30% federal tax credit, that's about $12,600. Financing options make solar accessible with $0 down. You're trading your utility payment for a solar payment that leads to ownership. After 6-10 years, you have free electricity! Want to learn more?",
                    "Investing in solar is more affordable than ever! While systems cost $15,000-$25,000 upfront, the 30% federal tax credit plus state incentives can cut that significantly. Most people finance, paying less monthly than their old electric bill. Over 25-30 years, you'll save $40,000-$100,000! Interested in exploring your options?"
                ];
                return costs[Math.floor(Math.random() * costs.length)];
            }
            
            // How it works
            if (/(how.*work|technology|science|function|panel.*work)/i.test(msg)) {
                const howItWorks = [
                    "Solar panels use photovoltaic cells made of silicon that absorb sunlight. When photons hit these cells, they knock electrons loose, creating DC electrical current. An inverter converts this to AC power for your home. On sunny days, excess power flows back to the grid, earning you credits! Even on cloudy days, modern panels generate 15-20% of peak power. It's completely automated!",
                    "The technology is fascinating! Photovoltaic cells absorb light photons, which frees electrons and creates electric current. Each panel has many cells producing DC electricity. Your inverter converts this to standard AC power. Any excess goes to the grid for credits through net metering. The system works automatically whenever there's light!",
                    "Solar panels use the photovoltaic effect - light energy excites electrons in silicon, creating DC electricity. The inverter converts this to AC power for your home. During peak sun, you generate more than you use - this excess earns grid credits. At night, you draw from the grid using banked credits. It's self-managing!"
                ];
                return howItWorks[Math.floor(Math.random() * howItWorks.length)];
            }
            
            // Environmental questions
            if (/environment|climate|carbon|green|clean|planet|eco|sustainable|pollution/i.test(msg)) {
                const environmental = [
                    "The environmental impact is phenomenal! Every year, a typical system prevents 3-4 tons of CO2 emissions - equivalent to planting 100 trees annually. Over 25 years, that's 100+ tons of CO2 offset! Solar produces zero air pollution, uses no water, and directly combats climate change. You're reducing demand for fossil fuels and helping create a cleaner planet!",
                    "Solar power is one of the best environmental actions you can take! A home solar system offsets the equivalent of driving 100,000 miles in a gas car over its lifetime. It prevents harmful emissions that cause smog, acid rain, and climate change. Unlike fossil fuel plants, solar uses no water and creates no toxic waste. It's personal climate action that really matters!",
                    "The benefits are immediate and lasting! From day one, your system starts preventing carbon emissions. Over its lifetime, it'll offset 100+ tons of CO2 - like planting thousands of trees. You eliminate air and water pollution from your electricity use. Every kilowatt-hour you generate is one less from coal or gas. It's powerful environmental impact!"
                ];
                return environmental[Math.floor(Math.random() * environmental.length)];
            }
            
            // Thank you
            if (/thank|thanks|appreciate/i.test(msg)) {
                const thanks = [
                    "You're very welcome! I'm always happy to help people discover solar benefits. Is there anything else you'd like to know, or would you like to speak with our team?",
                    "My pleasure! Solar energy is my passion. Feel free to ask more questions or schedule a consultation anytime!",
                    "Happy to help! If you'd like more detailed information or want to speak with our team, just let me know!"
                ];
                return thanks[Math.floor(Math.random() * thanks.length)];
            }
            
            // Goodbye
            if (/bye|goodbye|see you|gotta go|later/i.test(msg)) {
                const goodbyes = [
                    "Thanks for chatting! I hope I've helped you understand why solar is such a smart investment. Feel free to return anytime with questions. Have a sunny day! ☀️",
                    "It was great talking with you! Consider calculating your savings or scheduling a consultation. Come back anytime. Take care! ☀️",
                    "Goodbye! Remember, our calculator and team are here whenever you're ready. Stay bright! ☀️"
                ];
                return goodbyes[Math.floor(Math.random() * goodbyes.length)];
            }

            // Default
            const redirects = [
                "That's interesting! While my expertise is solar energy, I'm happy to chat. Since you're here, have you considered going solar? I can answer questions or connect you with our expert team!",
                "Good question! I specialize in solar energy, but I can try to help. Speaking of which, would you like to learn about solar benefits? I'm here to answer any questions you have!",
                "Thanks for asking! I focus mainly on solar energy topics. By the way, have you thought about whether solar might work for your home? I can help you explore the options!",
                "I appreciate the question! While solar energy is my specialty, I'm here for friendly conversation too. Would you like to learn about solar savings, schedule a consultation, or explore what solar could do for you?"
            ];

            return redirects[Math.floor(Math.random() * redirects.length)];
        }

        function addMessage(content, isUser) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.style.opacity = '0';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? '👤' : '☀️';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            if (isUser) {
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(avatar);
            } else {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
            }
            
            chatContainer.appendChild(messageDiv);
            
            // Store in history
            chatHistory.push({
                role: isUser ? 'user' : 'assistant',
                content: content,
                timestamp: new Date().toISOString()
            });
            
            setTimeout(() => {
                messageDiv.style.opacity = '1';
            }, 10);
            
            scrollToBottom();
            
            if (!isUser) {
                updateSuggestions(content.toLowerCase());
            }
            
            messageCount++;
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator active';
            typingDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = '☀️';
            
            const dotsDiv = document.createElement('div');
            dotsDiv.className = 'typing-dots';
            dotsDiv.innerHTML = '<span></span><span></span><span></span>';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(dotsDiv);
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const sendBtn = document.getElementById('sendBtn');
            const message = input.value.trim();
            
            if (message === '') return;
            
            addMessage(message, true);
            input.value = '';
            sendBtn.disabled = true;
            input.disabled = true;
            
            showTypingIndicator();
            
            setTimeout(() => {
                const response = getResponse(message);
                hideTypingIndicator();
                addMessage(response, false);
                
                sendBtn.disabled = false;
                input.disabled = false;
                input.focus();
            }, 1000 + Math.random() * 500);
        }

        function sendSuggestion(text) {
            document.getElementById('userInput').value = text;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
